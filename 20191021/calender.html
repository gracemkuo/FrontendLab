<!doctype html>
<html lang="zh-TW">

<head>
    <title>Title</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Great+Vibes&display=swap" rel="stylesheet">

    <style>
        html,
        body,
        header,
        .view {
            height: 100%;
            font-family: 'Great Vibes', cursive;
        }

        #calendar {
            margin: 0 auto;
            width: 1080px;
        }

        #right_month {
            font-size: 40px;
            color: white;
            text-align: center;
            margin-top: 10px;

        }

        #left_month {
            font-size: 40px;
            color: white;
            text-align: center;
            margin-top: 10px;
        }

        #titleyear {
            font-size: 40px;

        }

        #titlemonth {

            font-size: 60px;

        }

        .text-center {
            font-size: 40px;
            margin-top: 10px;
        }

        /* .container {
         

        } */

        .date>div {
            width: 120px;
            color: black;
            height: 15px;
            font-size: 10px;
            margin-left: 10px;

        }

        td {
            vertical-align: top;
            width: 120px;
            height: 80px;
            color: black;
            font-size: 30px;

        }

        .calendar-content>tr {

            border: 20px white
        }

        /* table {
            border-collapse: collapse;
        }

        table,
        th,
        td {
            border: 3px solid white;
        } */
    </style>

</head>

<body>
    <div class="view" style="background-image: url('https://images.unsplash.com/photo-1558346648-9757f2fa4474?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1050&q=80'); 
        background-repeat: no-repeat; background-size: cover; background-position: center center;">



        <div class="container">
            <div class="text-center row">
                <div class="col-4">

                </div>
                <div id="titleyear" class="col-4">2019</div>
                <div class="col-4">
                </div>
            </div>
            <div class="text-center row">

                <div class="col-4">
                    <input id="left_month" class="btn btn-link addData" type="button" value="Previous">
                </div>

                <div id="titlemonth" class="col-4"></div>


                <div class="col-4">
                    <input id="right_month" class="btn btn-link addData" type="button" value="Next">
                </div>

            </div>
        </div>

        <table id="calendar" style="border:3px white solid">
            <thead id="thead">
                <tr>
                    <th>
                        <p class="text-center">Sun</p>
                    </th>
                    <th>
                        <p class="text-center">Mon</p>
                    </th>
                    <th>
                        <p class="text-center">Tue</p>
                    </th>
                    <th>
                        <p class="text-center">Wed</p>
                    </th>
                    <th>
                        <p class="text-center">Thr</p>
                    </th>
                    <th>
                        <p class="text-center">Fri</p>
                    </th>
                    <th>
                        <p class="text-center">Sat</p>
                    </th>
                </tr>
            </thead>
            <tbody id="calendar-content">
            </tbody>
        </table>

        <div class="row">
            <div class="col-md-3 ml-md-auto mt-3">
                <button type="button" class="btn btn-dark ">Add New Event</button>
            </div>
        </div>
        <!-- The Modal -->
        <div class="modal fade" id="ModalAddNew">
            <div class="modal-dialog">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Add Event</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <!-- Modal body -->
                    <div class="modal-body">
                        <form>
                            <label>Year</label>
                            <input id="field_Year" type="datetime" class="form-control" />
                            <label>Month</label>
                            <input id="field_Month" type="text" class="form-control" />

                            <label>Day</label>
                            <input id="field_Day" type="tel" class="form-control" />
                            <label>Event</label>
                            <input id="field_Event" type="email" class="form-control" />
                        </form>
                    </div>
                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button id="ButtonAddNew" type="button" class="btn btn-primary">Save</button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- The Modal -->
        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
            </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
            </script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
            </script>

    </div>
    <script>
        var Calendar = [];
        var DataArr = [];
        var d = new Date();
        var _year = d.getFullYear();
        var _month = d.getMonth(); //return 0-11
        var _date = d.getDate();
        var _week = d.getDay(); //return 0-6

        //生成月曆
        function ShowCalender() {

            //清空畫面與陣列
            $('#calendar-content').empty();
            Calendar = [];

            if (!localStorage.getItem('data')) localStorage.setItem('data', JSON.stringify([]));
            DataArr = JSON.parse(localStorage.getItem('data'))

            //產生月份
            $('#titlemonth').text(GetMonthName(_month)).attr('value', _month);

            //取得這個第一天
            var firstDay = new Date(_year, _month, 1);

            //取得這個最後一天
            var lastDay = new Date(_year, _month + 1, 0);

            //取得上個月最後一天
            var lastDateOfLastMonth = new Date(_year, _month, 0);

            //console.log('lastDateOfLastMonth is',lastDateOfLastMonth);

            //顯示上個月在這個月的日曆 因為getDay()回傳0-6 所以要-1
            GetLastMonDate(firstDay.getDay() - 1, lastDateOfLastMonth);

            //顯示本月日期
            GetCurrentDate(firstDay, lastDay);

            //顯示下個月
            GetNextDate(lastDay);

            //根據陣列裡的資料數，取表格橫列數
            var rows = Calendar.length / 7;

            //產生表格row--tr
            for (var i = 0; i < rows; i++) {
                $('#calendar-content').append($('<tr>').addClass('week' + i));
            }

            for (let j = 0; j < Calendar.length; j++) {
                let week = parseInt(j / 7);
                let target = $('#calendar-content').find('.week' + week);
                target.append($('<td>').text(Calendar[j].date).addClass('date' + j).attr('id',
                    `${Calendar[j].month}${Calendar[j].date}`).attr('value', Calendar[j].date));
            }

            //console.log('lastDay',lastDay.getDate());
            //將這個月份的td掛上click事件
            //$('td').click(tdClick);
            for (let i = 1; i <= lastDay.getDate(); i++) {
                $(`td[id='${_month}${i}']`).click(tdClick);
                //console.log('tdClick', `${_month}${i}`);
            }
            LoadData();

        }

        function GetLastMonDate(lastMonthDateRange, lastDateOfLastMonth) {
            //抓上個月最後一天往前推範圍，取得'日'與'星期'
            let displaydate = lastDateOfLastMonth.getDate() - lastMonthDateRange;
            let displayweek = lastDateOfLastMonth.getDay() - lastMonthDateRange;

            for (var i = 0; i <= lastMonthDateRange; i++) {

                let Item = {
                    "month": lastDateOfLastMonth.getMonth(),
                    "date": displaydate,
                    "week": displayweek
                }
                displaydate++;
                displayweek++;

                Calendar.push(Item);
            }

        }

        function GetCurrentDate(firstDay, lastDay) {
            //抓取這個月第一天和最後一天'日'
            let start = firstDay.getDate();
            let final = lastDay.getDate();

            for (var i = start; i <= final; i++) {
                let today = new Date(_year, _month, i)
                let Item = {
                    "month": today.getMonth(),
                    "date": i,
                    "week": today.getDay()
                }

                Calendar.push(Item);
            }
        }

        function GetNextDate(lastDayofThisMonth) {
            let lastDayofThisMonth_Week = lastDayofThisMonth.getDay();
            let nextMonFirstDate = new Date(_year, _month + 1, 1);

            for (var i = 0; i < 6 - lastDayofThisMonth_Week; i++) {
                let Item = {
                    "month": nextMonFirstDate.getMonth(),
                    "date": nextMonFirstDate.getDate() + i,
                    "week": nextMonFirstDate.getDay() + i
                }

                Calendar.push(Item);

            }
        }


        //按左鈕月份減少
        function left_BtnClick() {
            if (_month > 1) {
                _month -= 1;
            } else {
                _month = 11;
                _year -= 1;
            }
            ShowCalender();
        }

        //按右鈕月份增加
        function right_BtnClick() {
            if (_month < 11) {
                _month += 1;
            } else {
                _month = 0;
                _year += 1;
            }
            ShowCalender();
        }

        //取得月份英文
        function GetMonthName(_month) {
            let MonthArray = ['Jan', 'Feb', 'Mar', 'Apr', 'May',
                'Jun', 'Jul', 'Aug', 'Sept',
                'Oct', 'Nov', 'Dec'
            ];
            return MonthArray[_month];
        }

        //隨modal月份，產生日期選項
        function Selection_Change() {

            let select_month = parseInt($('#list_Months').val());
            let month_range = select_month - 1 == 12 ? 0 : select_month + 1;
            let list_lastDay = new Date(_year, month_range, 0).getDate();

            //清空日期選項
            $('#list_Days').empty();

            for (let i = 0; i < list_lastDay; i++) {
                $('#list_Days').append(` <option value="${i + 1}">${i + 1}</option>`);
            }
        }

        //新增代辦事項
        function List_Add() {

            let select_month = parseInt($('#list_Months').val());
            let select_day = parseInt($('#list_Days').val());
            let list_content = $('#content').val();
            let today = new Date(_year, select_month, select_day)
            let flag = true;

            //如果日期欄位存在清單
            $.each(DataArr, (i, item) => {
                if (new Date(2019, item.month, item.date) - new Date(2019, select_month, select_day) == 0) {
                    item.content += `${list_content}<br>`;
                    flag = false;
                }
            })

            //如果日期欄位第一次新增清單
            if (flag) {
                let Item = {
                    "month": today.getMonth(),
                    "date": today.getDate(),
                    "week": today.getDay(),
                    "content": `<div class='showlist'>${list_content}<br></div>`
                }
                DataArr.push(Item);
            }

            localStorage.setItem('data', JSON.stringify(DataArr))

            CleanForm();
            LoadData();

        }

        //修改代辦事項

        //刪除代辦事項
        function List_Delete() {
            let this_day = parseInt($('#label_date').html());
            let this_month = parseInt($('#title_month').attr('value'));
            console.log('xxx', this_month, this_day);
            $.each(DataArr, (i, item) => {
                //console.log('yyy', item.month, item.date);
                if (new Date(2019, item.month, item.date) - new Date(2019, this_month, this_day) == 0) {
                    //console.log('zzz', item.month, item.date);
                    DataArr.splice(i, 1);
                }
            })
            localStorage.setItem('data', JSON.stringify(DataArr));

            ShowCalender();
        }

        //點擊顯示資料
        function tdClick() {
            let this_day = parseInt($(this).attr('value'));
            let this_month = parseInt($('#title_month').attr('value'));
            let this_content = $(`td[id='${this_month}${this_day}']`).html() == undefined ? '' : $(
                `td[id='${this_month}${this_day}']`).html().replace(/<br>/g, '\n');
            //<td class="date4" id="931">31</td>
            // console.log('this_day', this_day,$(this).val());
            // console.log('this_month', this_month);
            // console.log('this_content', this_content);

            $('#label_date').html(this_day);
            $('#label_month').html(this_month + 1);
            $('#Edit_content').val(`${this_content}`);
            $('#AddEdit').modal();

        }

        //清除選單資料
        function CleanForm() {
            $('#list_Months').val('');
            $('#list_Days').val('');
            $('#content').val('');
        }

        //載入存放資料
        function LoadData() {
            if (DataArr == []) return;

            let array = DataArr.filter(x => x.month == _month)
            $.each(array, (i, item) => {

                //依照id存放Data
                $(`td[id="${item.month}${item.date}"]`).append(`<br>${item.content}`)
                //<td class="date12" id="108">8</td>         
            })
        }




        $(function () {

            ShowCalender();

            $('#left_month').click(left_BtnClick);
            $('#right_month').click(right_BtnClick);
            $('#addlist_Window').click(function () {
                $('#AddList').modal();
            });
            $('#btn_Add').click(List_Add);
            $('#btn_Delete').click(List_Delete);
            $('#list_Months').change(Selection_Change);



            //新增modal月份選項
            for (let i = 0; i < 12; i++) {
                $('#list_Months').append(` <option value="${i}">${i + 1}</option>`);
            }

        });
    </script>

</body>

</html>